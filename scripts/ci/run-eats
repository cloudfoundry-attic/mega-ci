#!/bin/bash

set -e -x

source ~/.bashrc

echo "Sourcing bosh_environment"
set +x
source private-credentials/mega-ci/bosh_environment
set -x
echo "Done sourcing bosh_environment"

cat > eats_config.json <<EOF
{
  "bosh_target": "$BOSH_DIRECTOR",
  "iaas_settings_etcd_stub_path": "$PWD/$IAAS_SETTINGS_ETCD",
  "iaas_settings_turbulence_stub_path": "$PWD/$IAAS_SETTINGS_TURBULENCE",
  "turbulence_properties_stub_path": "$PWD/$PROPERTY_OVERRIDES_TURBULENCE",
  "cpi_release_url": "$CPI_RELEASE_URL",
  "cpi_release_name": "$CPI_RELEASE_NAME",
  "bosh_operation_timeout": "$BOSH_OPERATION_TIMEOUT",
  "turbulence_release_url": "$TURBULENCE_RELEASE_URL"
}
EOF

cat eats_config.json

cd etcd-release

EATS_CONFIG=$PWD/../eats_config.json ./scripts/test



